*** Settings ***
Library         SeleniumLibrary  ${EMPTY}  ${EMPTY}  ${SELENIUM PORT}
Library         OperatingSystem
Library         RFDocDataBase
Library         NameParser

*** Variables ***
${RFDOC PORT}  8000
${SELENIUM PORT}  4444
${HOST}  localhost:${RFDOC PORT}
${BASE URL}  http://${HOST}
${BROWSER}  firefox
@{BUILTIN KEYWORDS}  Convert To Integer  item  Converts the given item to an integer number.  No Operation  ${EMPTY}  Does absolutely nothing.
@{EXAMPLELIBRARY VERSION 1 KEYWORDS}  First Keyword  first, second=default, *args  First KW doc  My Second Keyword  some  Second KW doc
@{EXAMPLELIBRARY VERSION 2 KEYWORDS}  First Keyword Updated  first, second=default updated, *args  Updated KW doc  My Second Keyword  some  Second KW doc  Third Keyword  third  Third KW doc

*** Keywords ***

Given no libraries exist in RFDoc
    Clear RFDoc Database

${Some libraries} exist${s} in RFDoc
    Copy file  ${CURDIR}/../testdata/libraries.db  ${CURDIR}/../results/rfdoc.db

"Main" page is open
    Go to  ${BASE URL}

"${name}" page is open
    Go to  ${BASE URL}/${name.lower()}

"${name}" page is opened
    Location should be  ${BASE URL}/${name}/

Error "${message}" is shown
    Element should contain  xpath=//ul[@class='errorlist']  ${message}

User selects "${name}" option
    Select checkbox  ${name}

Notification "${message}" is shown
    Page should contain  ${message}

Notification contains a link to ${library}
    Page should contain link  /lib/${library}  ${library}

Navigate to library "${name}"
    Go to  ${BASE URL}/lib/${name}
    Title should be  RFDoc | ${name}

User uploads ${library}
    ${file} =  Set Variable  ${library.replace(' ', '_')}.xml
    Upload ${file}

Upload ${file}
    Input text  file  ${CURDIR}${/}..${/}testdata${/}${file}
    Click button  Upload

RFDoc contains ${library name with possible version}
    ${name} =  Get library name  ${library name with possible version}
    Navigate to library "${name}"
    @{keywords} =  Set variable  @{${library name with possible version} KEYWORDS}
    Library should contain keywords  @{keywords}

Library should contain keywords  [Arguments]  @{keywords}
    ${source} =  Get source
    :FOR  ${name}  ${args}  ${doc}  IN  @{keywords}
    \  Source should contain keyword  ${source}  ${name}  ${args}  ${doc}

Source should contain keyword  [Arguments]  ${source}  ${name}  ${args}  ${doc}
    ${match}  ${group1}  ${group2} =  Should Match Regexp  ${source}  (?s)<td class="kw" id="${name}">${name}</td>\\s*<td class="arg">(.*?)</td>\\s*<td class="doc">(.+?)</td>
    Should be equal  ${group1}  ${args}
    Should be equal  ${group2}  ${doc}

